perf tool for BRCMSTB Android TV
================================

This document describes the steps to build and load the perf tool for the AndroidTV platform on
Broadcom's ARM based STB SoCs. The procedure is generic enough to work on other Android systems
as well.

1. Download and unzip the latest Android NDK:
Android NDK can be found at https://developer.android.com/ndk/downloads/index.html. At the time
of the writing of this document, r16b was the latest version.

>wget https://dl.google.com/android/repository/android-ndk-r16b-linux-x86_64.zip
>unzip android-ndk-r16b-linux-x86_64.zip

2. Make standalone NDK toolchain:
This step is necessary to put the build tools and sysroot at a known location.

>cd android-ndk-r16b
>./build/tools/make_standalone_toolchain.py --arch arm --install-dir <toolchain_and_sysroot_dir> --api 27

The --api parameter is crucial to obtain the complete sysroot environment. Using api version lower than 24
on Android-O resulted in perf link errors.

3. Build perf tool:
This needs to be done from the Linux kernel folder where perf is located.

>cd /<path_to_brcmstb_kernel>/tools/perf
>export NDK_TOOLCHAIN=<toolchain_and_sysroot_dir>/bin/arm-linux-androideabi-
>export NDK_SYSROOT=<toolchain_and_sysroot_dir>/sysroot
>make WERROR=0 ARCH=arm CROSS_COMPILE=${NDK_TOOLCHAIN} CFLAGS="-fPIE --sysroot=${NDK_SYSROOT}" LDFLAGS="-pie"

The "-fPIE" and "-pie" CFLAGS and LDFLAGS are needed to build perf as a position independent executable which is
a requirement since Android-L. The perf executable will be generated in the perf directory.

4. Push to Android target:

>adb root
>adb push perf /data

This will push perf to the /data (userdata partition) directory on the target.
